<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IVEN Hub — Dashboard</title>
<link rel="manifest" href="/manifest.json" />
<meta name="theme-color" content="#0a1830" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-1:#030616;
    --panel:#071027;
    --card:#0b1324;
    --accent1:#7c4dff;
    --accent2:#2bb6ff;
    --muted:rgba(255,255,255,0.65);
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#e6eef8;background:
    linear-gradient(180deg,#020618 0%, #06081a 100%);}
  header{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    color:#fff;padding:10px 16px;text-align:center;font-weight:700;letter-spacing:1px;
    position:sticky;top:0;z-index:50;box-shadow:0 8px 30px rgba(2,6,20,0.6);
  }

  /* layout */
  .page{max-width:1200px;margin:20px auto;padding:0 12px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:22px;align-items:start}
  @media(max-width:980px){ .grid{grid-template-columns:1fr} }

  /* left panel (big) */
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 18px 40px rgba(3,6,16,0.6);
  }
  .panel .toolbar{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-bottom:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:800;color:#051426}
  .title{font-weight:800;font-size:16px}
  .subtitle{font-size:13px;color:var(--muted)}

  .actions{display:flex;gap:8px;align-items:center}
  .btn{
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);color:#eaf8ff;padding:8px 12px;border-radius:8px;
    font-weight:600;cursor:pointer;box-shadow:0 12px 26px rgba(3,6,16,0.45);transition:transform .12s;
  }
  .btn:hover{transform:translateY(-3px)}
  .btn.primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#021026}

  /* embed container with white inner frame (looks like spreadsheet) */
  .embed-wrap{
    margin-top:8px;border-radius:10px;background:linear-gradient(180deg,#ffffff, #fefefe);padding:10px;
    box-shadow:0 14px 36px rgba(2,8,24,0.35);border:1px solid rgba(0,0,0,0.06);
  }
  .inner-frame{
    background:#fff;border-radius:8px;overflow:auto;border:1px solid #ddd;padding:6px;
    height:540px; /* fixed height to match screenshot */
  }
  .inner-frame iframe{width:100%;height:100%;border:0;display:block;background:white}

  /* right card */
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 14px 28px rgba(2,6,18,0.5)
  }
  .card h3{margin:0 0 8px 0}
  .stat{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02);font-weight:700}
  .stat .val{color:var(--muted)}

  /* small misc */
  .neon{height:3px;border-radius:6px;background:linear-gradient(90deg,var(--accent2),var(--accent1));margin:10px 0}
  footer{color:var(--muted);text-align:center;margin-top:18px;font-size:13px}
</style>
</head>
<body>
<header>IVEN Hub — All Portals</header>

<div class="page">
  <div class="grid">
    <!-- left big -->
    <div class="panel">
      <div class="toolbar">
        <div class="brand">
          <div class="logo">IV</div>
          <div>
            <div class="title">IVEN Hub</div>
            <div class="subtitle">Central portal — open forms, dashboards and scripts</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="quickBtn">Quick Links ▾</button>
          <button class="btn primary" id="openForm">Open Form</button>
        </div>
      </div>

      <div class="neon"></div>

      <div class="embed-wrap">
        <div class="inner-frame" id="innerFrame">
          <!-- white framed look containing the published sheet -->
          <iframe id="dashFrame" src="" title="Token Dashboard" loading="lazy"></iframe>
        </div>
      </div>
    </div>

    <!-- right small -->
    <aside class="card">
      <h3>Live Stats <small style="float:right;color:var(--muted);font-weight:600">Auto-refresh enabled</small></h3>

      <div style="height:8px"></div>
      <div class="stat"><div>Total signups</div><div class="val" id="statSignups">—</div></div>
      <div class="stat"><div>Total tokens</div><div class="val" id="statTokens">—</div></div>
      <div class="stat"><div>Average token value</div><div class="val" id="statAvg">—</div></div>

      <div style="height:14px"></div>
      <div style="display:flex;flex-direction:column;gap:10px">
        <button class="btn" id="openRepo">Open GitHub</button>
        <button class="btn" id="reloadDash">Reload Dashboard</button>
      </div>
    </aside>
  </div>

  <footer>Add this site to Home Screen for app view</footer>
</div>

<script>
/* ========== CONFIG - put published-sheet pubhtml URL here (File -> Publish to web -> choose sheet 'Token Dashboard') ========== */
const DASHBOARD_PUB_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTGcw0IPTiS9dS7C8Jz0CBLuozkJBlSqrPfij68738ODwWZv6V56-FsEZ-Qazqovd9z-flqoUzR1ub7/pubhtml?gid=868314349&single=true';
const FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdHFQ3s_W01cHTDRcU6dOKsRnLTuJS--78jZcwTs0pqVaLE8A/viewform?fbzx=-3015865399314829091';
const REPO_URL = '--- REPLACE WITH YOUR GITHUB REPO/GH-PAGES URL ---';

const IFRAME_REFRESH_MS = 30 * 1000;

/* UI refs */
const iframe = document.getElementById('dashFrame');
const openFormBtn = document.getElementById('openForm');
const openRepoBtn = document.getElementById('openRepo');
const reloadDashBtn = document.getElementById('reloadDash');

function loadDashboard(){
  if(!DASHBOARD_PUB_URL || DASHBOARD_PUB_URL.includes('REPLACE')){
    // show a friendly message inside the iframe container instead of invalid iframe
    const inner = document.getElementById('innerFrame');
    inner.innerHTML = '<div style="color:#24324a;padding:20px;font-weight:700">Dashboard URL not configured. Paste published-sheet pubhtml link into index.html config.</div>';
    return;
  }
  // set iframe src to published sheet
  iframe.src = DASHBOARD_PUB_URL;
}

/* auto refresh - try soft reload */
let refreshTimer = null;
function startAutoRefresh(){
  stopAutoRefresh();
  refreshTimer = setInterval(()=>{
    try{
      if(iframe && iframe.contentWindow) iframe.contentWindow.location.replace(iframe.src);
      else iframe.src = iframe.src;
    }catch(e){ iframe.src = iframe.src; }
  }, IFRAME_REFRESH_MS);
}
function stopAutoRefresh(){ if(refreshTimer){ clearInterval(refreshTimer); refreshTimer = null } }

/* handlers */
openFormBtn.addEventListener('click', ()=> { if(FORM_URL && !FORM_URL.includes('REPLACE')) window.open(FORM_URL,'_blank'); else alert('Replace FORM_URL in index.html with your form link.'); });
openRepoBtn.addEventListener('click', ()=> { if(REPO_URL && !REPO_URL.includes('REPLACE')) window.open(REPO_URL,'_blank'); else alert('Replace REPO_URL in index.html with your repo link.'); });
reloadDashBtn.addEventListener('click', ()=> { iframe.src = iframe.src; });

window.addEventListener('online', ()=> { startAutoRefresh(); });
window.addEventListener('offline', ()=> { stopAutoRefresh(); });

/* ---------- Fetch live stats from Apps Script web app ---------- */
const DASHBOARD_API_URL = 'https://script.google.com/macros/s/AKfycbxs9baRvJoMCb540cw1VYn0SLwG2xt8LnQrlnSwPnEk6CVNp7PVS8G1ViWkfgyY3ECPHQ/exec';

async function fetchAndUpdateStats() {
  try {
    const res = await fetch(DASHBOARD_API_URL, { cache: 'no-store' });
    if (!res.ok) throw new Error('API error ' + res.status);
    const data = await res.json();

    const setText = (id, value) => {
      const el = document.getElementById(id);
      if (el) el.textContent = (value !== undefined && value !== null) ? value : '—';
    };

    setText('statSignups', data.totalSignups);
    setText('statTokens', data.totalTokens);
    setText('statAvg', data.avgValue);

  } catch (err) {
    console.warn('Stats fetch failed', err);
  }
}

// run once now and then every 30 seconds
fetchAndUpdateStats();
setInterval(fetchAndUpdateStats, 30 * 1000);

/* initialize */
document.addEventListener('DOMContentLoaded', ()=>{
  loadDashboard();
  if(navigator.onLine) startAutoRefresh();
});

/* optional: PWA install prompt (if manifest + service worker present) */
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt = e; /* show your install button if you want */ });
</script>
</body>
</html>
